name: Workflow Manager

on:
  workflow_dispatch:
    inputs:
      builder:
        description: "Builders"
        required: true
        type: choice
        options:
          - "Builder1"
          - "Builder2"
          - "Builder3"
          - "Builder4"
          - "Builder5"
        default: "Builder1"
      environment:
        description: "The deployment environment"
        required: true
        type: choice
        options:
          - "Environment1"
          - "Environment2"
          - "Environment3"
          - "Environment4"
          - "Environment5"
        default: "Environment1"
      changelog:
        description: "Built app changelog"
        required: true
        default: "Test"
        
run-name: "${{ inputs.builder }}-${{ github.ref_name }}-${{ inputs.environment }} | #${{ github.run_number }}"

jobs:
    job1:
        name: "Name Resolver"
        runs-on: ubuntu-latest
        outputs:
            app_version: $color
        steps:
            - id: step1
              if: ${{ inputs.builder }} == 'Builder1'
              run: echo "color=blue" >> $GITHUB_ENV
            - id: step2
              if: ${{ inputs.builder }} == 'Builder2'
              run: echo "color=blue" >> $GITHUB_ENV
    job2:
      name: ${{ needs.job1.outputs.app_version }}
      needs: job1
      if: ${{ inputs.builder }} == 'Builder1'
      runs-on: ubuntu-latest
      permissions:
        actions: write
      steps:
        - id: step1
          env:
            GH_TOKEN: ${{secrets.GITHUB_TOKEN}}
          run: |
            echo "${{ needs.job1.outputs.app_version }}"
            gh api \
              --method POST \
              -H "Accept: application/vnd.github+json" \
              -H "X-GitHub-Api-Version: 2022-11-28" \
              /repos/brunmmartins/GithubActionsTest/actions/workflows/manual.yml/dispatches \
              -f "ref=${{ github.ref_name }}" -f "inputs[helloworld]=${{ needs.job1.outputs.app_version }}"
    job3:
      name: ${{ needs.job1.outputs.app_version }}
      needs: job1
      if: ${{ inputs.builder }} == 'Builder2'
      runs-on: ubuntu-latest
      permissions:
        actions: write
      steps:
        - id: step1
          env:
            GH_TOKEN: ${{secrets.GITHUB_TOKEN}}
          run: |
            echo "${{ needs.job1.outputs.app_version }}"
            gh api \
              --method POST \
              -H "Accept: application/vnd.github+json" \
              -H "X-GitHub-Api-Version: 2022-11-28" \
              /repos/brunmmartins/GithubActionsTest/actions/workflows/manual.yml/dispatches \
              -f "ref=${{ github.ref_name }}" -f "inputs[helloworld]=${{ needs.job1.outputs.app_version }}"
